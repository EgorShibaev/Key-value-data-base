# Курс основ программирования на МКН СПбГУ

## Проект 2: key-value база данных

### Иснтрукция по использованию

Комманды для работы с базой данных:
```
1. content - выводит на экран содержимое базы данных в формате key -> value.
2. insert key -> value - вставляет в базу данных пару (key, value)
3. update key -> value - изменяет значение для поля key на value
4. find key - находит значение для поля key
5. findRegex pattern - находит все ключи (и значения для них) которых соответсвуют regex.
6. erase key - удаляет поле key
7. eraseRegex pattern - удаляет все поля для которых ключ соотвтсвует regex
8. clear - очищает базу данных
9. createGroup name - создаёт группу с именем name
10. eraseGroup name - удаляет группу с именем name
11. insertInGroup key -> name - добывляет ключ key в группу name (key должен существовать в базе данных)
12. eraseFromGroup name -> key - удаляет ключ key из группы name
13. findInGroup name -> key - ищет значения для ключа key в группе name
14. contentOfGroup name - выводит содержимое группы name
15. contentOfAllGroups - выводит содержимое всех групп
17. rollback - отменяет последнюю команду
18. exit - выход
19. save - сохраняет данные в файл
```
База данных шифруется после каждого сохранения. Для шифровки от пользователя требуется ключ. Ключ может отличаться при
при каждом сохранении, главное, чтобы при входе ключ совпадал с тем, который был указан при сохранении.

Присутствует возможность запускать программу для работы с командами написанными в файле. Для этого требуется указать
опцию -f (или --file) в аргументах командной строки, затем имя файла с командами, и затем (не обязательно) имя файла
куда перенаправить вывод программы.

### Принцип работы программы

#### Общие принципы

База данных хранится в файле database. При каждом запуске база данных дешифруется и загружается в оперативную память.
Вся работа с пользователем происходит в функции workingProcess. При каждой итерации цикла происходит следующее:
команда пользователя считывается и обрабатывается. Далее аргументы проверяются на корректность (добавляемые ключи не
присутствуют, удаляемые присутствуют и т.д.). На следующем шаге сохраняется информация, достаточная для отката этой
операции. Потом вызавается функция, которая обрабатывает данную команду.

#### Шифрование

В программе реализован обычный алгоритм шифрования
["перестановка по ключу"](https://neudoff.net/info/informatika/metod-shifruyushhix-tablic-s-odinochnoj-perestanovkoj-po-klyuchu/)
Единственное добавление заключается в приписывании в конец исходного текста определённой строки и проверка после 
расшифровки, что она осталась (улучшение заключается в том, что если ввести неправильный ключ той же длинны, то
последняя строка будет отличаться, и программа сообщит о неправильном ключе, а не загрузит некорректные данные).

### Тестирование

Помимо модульного тестирования к отдельным фунциям присутствует несколько наборов входных данных в папке tests. Для
тестирования требуется указать в параметрах командной строки "-f tests/testN/input.txt tests/testN/output.txt", где N -
номер теста.